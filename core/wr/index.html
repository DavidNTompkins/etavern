<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>eTavern</title>
  <meta name="description" content="the seediest watering hole on the web">
  <meta name="author" content="David Tompkins">

  
  <script src="https://rtcmulticonnection.herokuapp.com/dist/RTCMultiConnection.min.js"></script>
  <script src="https://rtcmulticonnection.herokuapp.com/socket.io/socket.io.js"></script>
  
</head>

<body>



  <button id="btn-open-room">Open Room</button>
  <button id="btn-join-room">Join Room</button><hr>

<script type="text/javascript">

//some dummy variables until I get everything integrated
local_username="Hogs"
local_texture="Rabbits"
local_facemesh="Bananas"

var connection = new RTCMultiConnection();

// this line is VERY_important
connection.socketURL = 'https://rtcmulticonnection.herokuapp.com:443/';

connection.session = {
    audio: true,
    data: true,
    video: false
};

connection.mediaConstraints = {
    audio: true,
    video: false
};

connection.sdpConstraints.mandatory = {
    OfferToReceiveAudio: true,
    OfferToReceiveVideo: false
};

// unclear if this is just creating video? Should try removing.
connection.onstream = function(event) {
    document.body.appendChild( event.mediaElement );
    connection.send({
    username: local_username,
    texture: local_texture,
    facemesh: local_facemesh
});
};

//sending data - should be within facemodel (on each update)


//receiving data - should include a call to render new faces (I think this will be better than rendering in waves)
connection.onmessage = function(event) {
    var other_user = event.username;
    var other_texture = event.texture;
    var facemesh = event.facemesh;
    console.log(facemesh)
};


var predefinedRoomId = 'etavern';

document.getElementById('btn-open-room').onclick = function() {
    this.disabled = true;
    connection.open( predefinedRoomId );
};

document.getElementById('btn-join-room').onclick = function() {
    this.disabled = true;
    connection.join( predefinedRoomId );
};
</script>

</body>
</html>